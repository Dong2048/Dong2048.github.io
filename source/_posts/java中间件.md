---
title: java中间件
date: 2022-02-10 10:24:38
tags: java
cover: https://s4.ax1x.com/2022/02/10/HYNjJg.jpg
category: 笔记
top_img: https://s4.ax1x.com/2022/02/10/HYNjJg.jpg
---
##RabbitMQ
#### RabbitMQ的使用场景有哪些？
（1）抢购活动，削峰填谷，防止系统崩塌。    
（2）延迟信息处理，比如10分钟之后给下单未付款的用户发送邮件提醒。    
（3）解耦系统，对于新增的功能可以单独写模块扩展，比如用户确认评价后，新增了给用户反积分的功能，这个时候不用在业务代码里添加
新增积分的功能，只需要吧新增积分的接口订阅确认评价的消息队列即可，后面再添加任何功能只需要订阅对应的消息队列即可。  
#### RabbitMQ中有哪些角色？
角色：生产者、消费者、代理  
（1）生产者：消息的创建者，负责创建和推送数据到消息服务器。  
（2）消费者：消息的接收方，用于处理数据和确认消息。  
（3）代理：RabbitMQ本身，扮演"快递"的角色，本身不生产消息，只是扮演"快递"的角色。  
#### RabbitMQ有哪些重要的组件？
（1）ConnectionFactory（连接管理器）：应用程序与Rabbit之间建立连接的管理器，程序代码中使用。  
（2）Channel（信道）：消息推送使用的通道。  
（3）Exchange（交换器）：用于接收、分配消息。  
（4）Queue（队列）：用于存储生产者的消息。  
（5）RoutingKey（路由键）：用于把生成着的数据分配到交换器上。  
（6）BindingKey（绑定键）：用于把交换器的消息绑定到队列上。  
#### #RabbitMQ中vhost的作用是什么？
Vhost：每个RabbitMQ都能创建很多vhost，我们称之为虚拟主机，每个虚拟主机其实都是mini版的RabbitMQ，它拥有自己的队列，交换器和
绑定，拥有自己的权限机制。  
#### RabbitMQ的消息是怎么发送的？
首先客户端必须连接到RabbitMQ服务器才能发布和消费消息，客户端和Rabbit server之间会创建一个tcp链接，一旦tcp打开并通过认证（认证
就是发送给rabbit服务器的用户名和密码），客户端和RabbitMQ就创建了一条amqp信道（channel），信道是创建在"真实"tcp上的虚拟连接，
amqp命令都是通过信道发送出去的，每个信道都会有一个唯一的id，不论是发布消息，订阅队列都是通过这个信道完成的。  
#### RabbitMQ怎么保证消息的稳定性？
（1）提供了事物的功能。  
（2）通过将channel设置为confirm（确认）模式。  
#### RabbitMQ怎么避免消息丢失？
（1）把消息持久化磁盘，保证服务器重启消息不丢失。  
（2）每个集群中至少又一个物理磁盘，保证消息落入磁盘。  
#### 要保证消息持久化成功的条件有哪些？
（1）声明队列必须设置持久化durable设置为true。  
（2）消息推送投递模式必须设置持久化，deliveryMode设置为2（持久）。  
（3）消息已经到达持久化交换器。  
（4）消息已经到达持久化队列。  
#### RabbitMQ持久化有什么缺点？
持久化的缺点就是降低了服务器的吞吐量，因为使用的是磁盘而非内存存储，从而降低了吞吐量。可尽量使用ssd硬盘来缓解吞吐问题。  
#### RabbitMQ有几种广播模式？
（1）direct（默认方式）：最基础最简单的模式，发送方把消息发送给订阅方，如果有多个订阅者，默认采取轮询的方式进行消息发送。  
（2）headers：与direct类似，只是性能很差，此类型几乎用不到。  
（3）fanout：分发模式，把消息分发给所有订阅着。  
（4）topic：匹配订阅模式，使用正则匹配到消息队列，能匹配到的都能接受到。  
#### RabbitMQ怎么实现延迟消息队列？
延迟队列的实现有两种方式：  
（1）通过消息过期后进入死信交换器，再由交换器转发到延迟消费队列，实现延迟功能。  
（2）使用RabbitMQ-delayed-message-exchange插件实现延迟功能。  
#### RabbitMQ集群有什么用？
集群主要有以下两个用途：  
（1）高可用：某个服务器出现问题，整个RabbitMQ还可以继续使用。    
（2）高容量：集群可以承载更多的消息量。  
#### RabbitMQ节点的类型有哪些？
（1）磁盘节点：消息会存储到磁盘。  
（2）内存节点：消息都存储在内存中，重启服务器消息丢失，性能高于磁盘类型。  
#### RabbitMQ集群搭建需要注意哪些问题？
（1）各节点之间使用"-link"连接，此属性不能忽略。  
（2）各节点使用的erlang cookie值必须相同，此值相当于"秘钥"的功能，用于各节点的认证。  
（3）整个集群中必须包含一个磁盘节点。  
#### RabbitMQ每个节点是其他节点的完整拷贝吗？
不是。原因如下：  
（1）存储空间的考虑：如果每个节点都拥有所有队列的完全拷贝，这样新增节点不但没有新增存储空间，反而增加了更多的冗余数据。  
（2）性能的考虑：如果每条消息都需要完整拷贝到每一个集群节点，那新增节点并没有提升处理消息的能力，最多是保持和但节点相同
的性能甚至是更糟。  
#### RabbitMQ集群中唯一一个磁盘节点崩溃了会发生什么情况？
如果唯一的磁盘节点崩溃了，不能进行以下的操作：  
（1）不能创建队列。  
（2）不能创建交换器。  
（3）不能创建绑定。  
（4）不能更改权限。  
（5）不能添加和删除集群节点。  
唯一磁盘节点崩溃了，集群是可以保持运行的，但不能更改任何的东西。  
#### RabbitMQ对集群节点停止顺序有要求吗？
RabbitMQ对集群的停止的顺序是有要求的，应该先关闭内存节点，最后再关闭磁盘节点，如果顺序恰好相反的话，可能会造成消息的丢失。  
##Kafka
#### kafka可以脱离zookeeper单独使用吗？
kafka不能脱离zookeeper单独使用，因为kafka使用zookeeper管理和协调kafka的节点服务器。  
#### kafka有几种数据保留策略？
kafka有两种数据保留策略：按照过期时间保留和按照存储的消息大小保留。
#### #kafka同时设置了7天和10G清除数据，到第五天的时候消息达到了10G，这个时候kafka将如何处理？
这个时候kafka会执行数据清除工作，时间和大小不论那个满足条件，都会清空数据。
#### 什么情况会导致kafka运行变慢？
（1）CPU性能瓶颈。 
（2）磁盘读写瓶颈。 
（3）网络瓶颈。  
#### 使用kafka集群需要注意什么？
（1）集群的数量不是越多越好，最好不超过7个，因为节点越多，消息复制需要的时间就越长，整个群组的吞吐量就越低。  
（2）集群数量最好是单数，因为超过一半的故障集群就不能用了，设置为单数容错率更高。
##Zookeeper
#### zookeeper是什么？
zookeeper是一个分布式的，开放源码的分布式应用程序协调服务，是google chubby的开源实现。是hadoop和hbase的
重要组件。它是一个分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。
#### zookeeper都有哪些功能？
（1）集群管理：监控节点存活状态、运行请求等。  
（2）主节点选举：主节点挂掉了之后可以从备用的节点开始新一轮选主，主节点选举说的就是这个选举的过程。
使用zookeeper可以协助完成这个过程。  
（3）分布式锁：zookeeper提供两种锁：独占锁、共享锁。独占锁即一次只能有一个线程使用资源，共享锁是读锁共享，读写互斥，
即可以有多线线程同时读同一个资源，如果要使用写锁也只能有一个线程使用。zookeeper可以对分布式锁进行控制。  
（4）命名服务：在分布式系统中，通过使用命名服务，客户端应用能够根据指定名字来获取资源或服务器的地址，提供者等信息。
#### zookeeper有几种部署模式？
zookeeper有三种部署模式：
（1）单机部署：一台集群上运行。  
（2）集群部署：多台集群运行。  
（3）一台集群启动多个zookeeper实例运行。  
#### zookeeper怎么保证主从节点的状态同步？
zookeeper 的核心是原子广播，这个机制保证了各个 server 之间的同步。实现这个机制的协议叫做 zab 协议。 zab 协议有两种模式，分别是恢复模式（选主）和广播模式（同步）。当服务启动或者在领导者崩溃后，zab 就进入了恢复模式，当领导者被选举出来，且大多数 server 完成了和 leader 的状态同步以后，恢复模式就结束了。状态同步保证了 leader 和 server 具有相同的系统状态。
#### 集群中为什么要有主节点？
在分布式环境中，有些业务逻辑只需要集群中的某一台机器进行执行，其他的机器可以共享这个结果，这样可以大大减少重复计算，提高性能，所以就需要主节点。
#### 集群中有三台服务器，其中一个节点宕机，这个时候zookeeper还可以使用吗？
可以继续使用，单数服务器只要没超过一半的服务器宕机就可以继续使用。
#### 说一下 zookeeper 的通知机制？
客户端端会对某个 znode 建立一个 watcher 事件，当该 znode 发生变化时，这些客户端会收到 zookeeper 的通知，然后客户端可以根据 znode 变化来做出业务上的改变。